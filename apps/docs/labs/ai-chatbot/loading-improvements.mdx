---
title: AI SDK Loading Improvements
description:
  Enhanced loading indicators following AI SDK best practices for better user
  experience
---

# AI SDK Loading Indicator Improvements

This document describes the improvements made to loading indicators in the AI
chatbot application, following AI SDK best practices.

## Changes Made

### 1. Enhanced ThinkingMessage Component

- **Location**: `src/components/message.tsx`
- **Improvements**:
  - Dynamic loading messages based on duration
  - Contextual messages that adapt to user queries
  - Visual enhancements with pulsing icon and animated dots
  - Removed 1-second delay for immediate feedback

### 2. Contextual Loading Messages

- **Location**: `src/lib/ai/loading-messages.ts`
- **Features**:
  - Analyzes user messages to determine context (code, questions, creative
    writing, etc.)
  - Provides appropriate loading messages based on:
    - Query type (code, question, creative, data analysis, research)
    - Duration (quick < 1s, medium 1-3s, longer 3-5s, extended 5s+)
    - Tool mentions (weather, documents, search)

### 3. Server-Side Status Updates

- **Location**: `src/app/(chat)/api/chat/action-postChat.ts`
- **Improvements**:
  - Sends real-time status updates through data stream
  - Contextual status based on user message content
  - Updates for RAG processing when knowledge base is searched

### 4. Custom Stream Status Hook

- **Location**: `src/hooks/use-stream-status.ts`
- **Purpose**:
  - Extracts status messages from the data stream
  - Provides real-time updates to the UI
  - Clears status when streaming completes

### 5. Tool-Specific Loading Component

- **Location**: `src/components/tool-loading.tsx`
- **Features**:
  - Shows specific loading indicators for different tools
  - Animated icons that match the tool being used
  - Status indicators (pending, running, complete)

## How It Works

1. **User sends a message** → Status changes to `submitted`
2. **Server analyzes message** → Sends contextual status updates
3. **ThinkingMessage appears** → Shows dynamic message based on:
   - Stream status (if available)
   - Message context analysis
   - Time elapsed
4. **Visual feedback** → Pulsing icon and animated dots
5. **Tool usage** → Special indicators for specific tools

## Example Loading Messages

### Code-Related Queries

- < 1s: "Looking at your code..."
- 1-3s: "Analyzing your code request..."
- 3-5s: "Writing and testing code solutions..."
- 5s+: "This is taking a bit longer than usual. Thank you for your patience..."

### General Questions

- < 1s: "Thinking about your question..."
- 1-3s: "Formulating a comprehensive answer..."
- 3-5s: "Researching to provide the best answer..."

### Tool-Specific

- Weather: "Checking weather conditions..."
- Document creation: "Creating document..."
- Knowledge search: "Searching knowledge base..."

## AI SDK Best Practices Implemented

1. **Immediate Feedback**: Removed artificial delays
2. **Granular Status Tracking**: Multiple loading states with contextual
   messages
3. **Stream Events**: Utilizing data stream for real-time status updates
4. **Performance**: Efficient rendering with memoization and throttling
5. **Error Handling**: Graceful fallbacks for missing status data
6. **Visual Continuity**: Consistent design with existing UI components

## Future Enhancements

1. **Progress Indicators**: For long-running operations
2. **Estimated Time**: Based on historical data
3. **Cancel/Retry**: Better error recovery UX
4. **Multi-step Progress**: For complex tool chains
5. **User Preferences**: Customizable loading message styles
