---
title: Google Gemini Enhanced Features
description:
  Advanced Google Gemini features including safety settings, search grounding,
  and caching
---

# Google Gemini Enhanced Features

This document describes the enhanced Google Gemini features available in the AI
chatbot.

## Overview

The application supports two modes for Google Gemini models:

1. **Basic Mode** (default) - Standard Google AI SDK integration
2. **Enhanced Mode** - Advanced features including safety settings, search
   grounding, and caching

## Enhanced Features

### 1. Safety Settings

Control content filtering thresholds for various harm categories:

- Hate speech
- Dangerous content
- Harassment
- Sexually explicit content

### 2. Search Grounding

Enable real-time web search to ground responses in current information.

### 3. Content Caching

Cache long conversations to improve performance and reduce costs.

### 4. Multi-modal Support

Handle images and PDF files in conversations.

## Configuration

### Environment Variables

```bash
# Enable enhanced Google provider (default: false)
GOOGLE_AI_ENHANCED=true

# Default model (optional)
GOOGLE_AI_MODEL=gemini-1.5-pro-latest

# Safety threshold (optional)
# Options: BLOCK_NONE, BLOCK_LOW_AND_ABOVE, BLOCK_MEDIUM_AND_ABOVE, BLOCK_ONLY_HIGH
GOOGLE_AI_SAFETY_THRESHOLD=BLOCK_MEDIUM_AND_ABOVE

# Enable search grounding (default: false)
GOOGLE_AI_SEARCH_GROUNDING=true

# Enable automatic caching (default: false)
GOOGLE_AI_ENABLE_CACHING=true

# Cache TTL in seconds (default: 3600)
GOOGLE_AI_CACHE_TTL=7200

# Custom safety settings (JSON)
GOOGLE_AI_SAFETY_SETTINGS='[{"category":"HARM_CATEGORY_HATE_SPEECH","threshold":"BLOCK_LOW_AND_ABOVE"}]'
```

### Using Enhanced Models

When `GOOGLE_AI_ENHANCED=true` is set, the enhanced Google provider will be used
automatically for all Google models.

## Available Models

### Standard Models

- `gemini-1.5-pro-latest` - Most capable model with 2M context
- `gemini-1.5-flash` - Fast model with 1M context
- `gemini-2.0-flash-exp` - Experimental next-gen model

### Enhanced Model Variants (when using enhanced provider)

- `gemini-1.5-pro-latest-grounded` - With search grounding enabled
- `gemini-1.5-flash-grounded` - Fast model with search grounding
- `gemini-1.5-pro-latest-cached` - With caching enabled

## Features in Action

### Safety Settings

The chat API automatically applies safety settings based on environment
configuration. You can see safety ratings in the console logs when a response is
generated.

### Search Grounding

When enabled, the model can search the web for current information. Search
queries and results are logged and tracked in telemetry.

### Caching

Long conversations (>4000 characters) are automatically cached when caching is
enabled. This improves response time for follow-up messages.

## Implementation Details

### Enhanced Provider (`GoogleAISdkProvider`)

Located in `/packages/ai/src/server/providers/google-ai-sdk-provider.ts`

Features:

- Configurable safety settings
- Search grounding support
- File attachment handling (images, PDFs)
- Content caching
- Provider metadata extraction
- Schema preprocessing for structured outputs

### Chat API Integration

The chat API (`action-postChat.ts`) includes:

- Dynamic Google configuration based on environment
- Automatic caching for long messages
- Safety and grounding metadata logging
- Telemetry integration

## Migration Guide

To enable enhanced features:

1. Add environment variables to your `.env.local`:

   ```bash
   GOOGLE_AI_ENHANCED=true
   GOOGLE_AI_SEARCH_GROUNDING=true
   ```

2. Restart your development server

3. Google models will now use the enhanced provider with configured features

## Troubleshooting

### Enhanced features not working

- Verify `GOOGLE_AI_ENHANCED=true` is set
- Check console logs for "Enhanced Google AI provider registered"
- Ensure Google API key is properly configured

### Search grounding not returning results

- Verify `GOOGLE_AI_SEARCH_GROUNDING=true`
- Check if the model supports grounding (most Gemini models do)
- Look for grounding metadata in console logs

### Caching not activating

- Check message length (auto-enables for >4000 chars)
- Or set `GOOGLE_AI_ENABLE_CACHING=true`
- Verify cache TTL is reasonable (default: 3600 seconds)
