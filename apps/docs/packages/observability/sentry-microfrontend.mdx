---
title: "Sentry Micro Frontend Plugin"
description:
  "Specialized Sentry plugin for micro frontend architectures with zone-based
  error routing"
---

# Sentry Micro Frontend Plugin

A specialized Sentry plugin designed for micro frontend architectures, built on
top of the base Sentry plugin with enhanced capabilities for zone-based error
routing, parent-child initialization detection, and multiplexed transport.

## Features

- **Automatic Mode Detection**: Detects whether the app is running as a host,
  child, or standalone
- **Zone-based Error Routing**: Routes errors to different Sentry projects based
  on micro frontend zones
- **Parent-Child Initialization**: Prevents duplicate Sentry initialization in
  child micro frontends
- **Multiplexed Transport**: Routes events to different DSNs based on zone
  information
- **Edge Runtime Compatible**: Works in both Node.js and Edge runtime
  environments
- **Thread-safe Initialization**: Prevents race conditions during initialization
- **Proper Cleanup**: Handles resource cleanup when the plugin is destroyed

## Architecture Overview

### Operation Modes

<AccordionGroup>
  <Accordion title="Host Mode (isHost: true)">
    - Initializes Sentry with multiplexed transport - Routes events to different
    projects based on zones - Makes Sentry globally available for child apps
  </Accordion>

<Accordion title="Child Mode (automatically detected)">
  - Uses parent Sentry instance for error reporting - Adds zone-specific context
  to events - Does not initialize its own Sentry instance
</Accordion>

  <Accordion title="Standalone Mode (default)">
    - Normal Sentry initialization for single applications - Used when no parent
    Sentry is detected
  </Accordion>
</AccordionGroup>

### Zone Configuration

Zones represent different micro frontend applications within your architecture:

```typescript
const zones: ZoneConfig[] = [
  {
    name: "cms",
    dsn: "https://cms-specific@sentry.io/project",
    pathPatterns: ["/cms"],
    tags: { zone: "cms" }
  },
  {
    name: "workflows",
    dsn: "https://workflows-specific@sentry.io/project",
    pathPatterns: ["/workflows"],
    tags: { zone: "workflows" }
  }
];
```

## Quick Start

### Using with Observability Presets

<CodeGroup>
```typescript Host App
import { createBackstageHostPreset } from '@repo/observability/factory/presets';

// Host app const hostObservability = createBackstageHostPreset([ { name: 'cms',
dsn: process.env.SENTRY_DSN_CMS }, { name: 'workflows', dsn:
process.env.SENTRY_DSN_WORKFLOWS }, ]).build();

await hostObservability.initialize();

````

```typescript Child App
import { createBackstageMicroFrontendPreset } from '@repo/observability/factory/presets';

// Child app
const childObservability = createBackstageMicroFrontendPreset('cms').build();

await childObservability.initialize();
````

</CodeGroup>

### Next.js Integration

<CodeGroup>
```typescript Host Application
// instrumentation.ts
import { initializeObservability } from './sentry.config';

export async function register() {
  await initializeObservability();
}

// sentry.config.ts import { createBackstageHostPreset } from
'@repo/observability/factory/presets';

const observability = createBackstageHostPreset([ { name: 'cms', dsn:
process.env.SENTRY_DSN_CMS }, { name: 'workflows', dsn:
process.env.SENTRY_DSN_WORKFLOWS }, ]).build();

export async function initializeObservability() {
  await observability.initialize();
  
  // Make Sentry globally available
  const sentryPlugin = observability.getPlugin('sentry-microfrontend');
  if (sentryPlugin) {
    globalThis.Sentry = sentryPlugin.getClient();
  }
}
```

```typescript Child Application
// instrumentation.ts
import { initializeObservability } from "./sentry.config";

export async function register() {
  await initializeObservability();
}

// sentry.config.ts
import { createBackstageMicroFrontendPreset } from "@repo/observability/factory/presets";

const observability = createBackstageMicroFrontendPreset("cms").build();

export async function initializeObservability() {
  await observability.initialize();
}
```

</CodeGroup>

## Configuration

### SentryMicroFrontendConfig

```typescript
interface SentryMicroFrontendConfig extends SentryPluginConfig {
  // Micro frontend specific options
  isHost?: boolean;
  zone?: string;
  zones?: ZoneConfig[];

  // Feature flags
  detectParent?: boolean; // Default: true
  addZoneContext?: boolean; // Default: true
  useMultiplexedTransport?: boolean; // Default: true
  preventDuplicateInit?: boolean; // Default: true

  // Transport options
  fallbackDsn?: string;
  globalTags?: Record<string, string>;
}
```

### ZoneConfig

```typescript
interface ZoneConfig {
  name: string; // Zone identifier
  dsn?: string; // Sentry DSN for this zone
  pathPatterns?: (string | RegExp)[]; // URL patterns for zone detection
  tags?: Record<string, string>; // Additional tags for events
  release?: string; // Zone-specific release version
}
```

## Environment Variables

<Tabs>
  <Tab title="Server-side">
    - `SENTRY_DSN_CMS` - DSN for CMS zone - `SENTRY_DSN_WORKFLOWS` - DSN for
    workflows zone - `SENTRY_DSN_AUTHMGMT` - DSN for auth management zone -
    `SENTRY_MICROFRONTEND_MODE` - Force mode (host/child/standalone) -
    `SENTRY_MICROFRONTEND_ZONE` - Override zone detection -
    `SENTRY_MICROFRONTEND_ENABLED` - Enable/disable micro frontend features -
    `SENTRY_MICROFRONTEND_MULTIPLEXED_TRANSPORT` - Enable multiplexed transport
  </Tab>

  <Tab title="Client-side">
    - `NEXT_PUBLIC_SENTRY_DSN_CMS` - Client-side CMS DSN -
    `NEXT_PUBLIC_SENTRY_DSN_WORKFLOWS` - Client-side workflows DSN -
    `NEXT_PUBLIC_SENTRY_DSN_AUTHMGMT` - Client-side auth management DSN -
    `NEXT_PUBLIC_SENTRY_MICROFRONTEND_MODE` - Client-side mode override -
    `NEXT_PUBLIC_SENTRY_MICROFRONTEND_ZONE` - Client-side zone override -
    `NEXT_PUBLIC_SENTRY_MICROFRONTEND_ENABLED` - Client-side enable flag
  </Tab>
</Tabs>

## Event Flow

### Host Mode Event Flow

<Steps>
  <Step title="Event occurs in child micro frontend">
    An error or event is triggered within a child micro frontend application.
  </Step>
  <Step title="Child adds zone context">
    The child app adds zone-specific context and metadata to the event.
  </Step>
  <Step title="Host examines event">
    The host's multiplexed transport examines the event to determine routing.
  </Step>
  <Step title="Transport routes event">
    The transport routes the event to the appropriate DSN based on zone
    information.
  </Step>
  <Step title="Event sent to zone project">
    The event is sent to the zone-specific Sentry project for processing.
  </Step>
</Steps>

### Child Mode Event Flow

<Steps>
  <Step title="Event occurs in child">
    An error or event is triggered within the child micro frontend.
  </Step>
  <Step title="Child uses parent Sentry">
    The child app uses the parent Sentry instance instead of its own.
  </Step>
  <Step title="Zone scope applied">
    Zone-specific scope and context is applied to the event.
  </Step>
  <Step title="Event enhanced">
    The event is enhanced with micro frontend context and metadata.
  </Step>
  <Step title="Parent processes event">
    The parent Sentry instance processes the event through normal channels.
  </Step>
</Steps>

## Best Practices

<CardGroup cols={2}>
  <Card title="Zone Configuration" icon="gear">
    - Use consistent zone names across all applications
    - Define clear path patterns for automatic zone detection
    - Include meaningful tags for filtering and grouping
  </Card>
  
  <Card title="Error Context" icon="bug">
    Always include relevant context when capturing errors:
    ```typescript
    observability.captureException(error, {
      component: 'ProductForm',
      action: 'save',
      productId: product.id,
    });
    ```
  </Card>
  
  <Card title="Environment Setup" icon="cloud">
    - Use separate Sentry projects for each zone in production
    - Share DSNs for development/staging environments if needed
    - Set appropriate sampling rates for each environment
  </Card>
  
  <Card title="Testing" icon="flask">
    - Use the `resetInitFlag()` utility in tests to reset initialization state
    - Mock global Sentry object in test environments
    - Test both host and child mode scenarios
  </Card>
</CardGroup>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Duplicate Initialization Errors">
    **Error**: `Sentry has already been initialized!` **Solutions**: - Ensure
    only one instance calls `isHost: true` - Check that child apps don't
    initialize their own Sentry - Verify proper module loading order
  </Accordion>

<Accordion title="Events Not Routing to Correct Project">
  **Issue**: Events appear in wrong Sentry project or not at all **Solutions**:
  - Verify zone detection is working correctly - Check that zone DSNs are
  properly configured - Ensure multiplexed transport is enabled - Check path
  patterns match your routing
</Accordion>

  <Accordion title="Parent Sentry Not Found">
    **Error**: Child app can't find parent Sentry instance **Solutions**: -
    Verify host app initializes before child apps - Check that Sentry is made
    globally available - Ensure proper module loading order - Check for script
    loading issues
  </Accordion>
</AccordionGroup>

### Debug Information

Use the `getDebugInfo()` method to inspect plugin state:

```typescript
const plugin = observability.getPlugin("sentry-microfrontend");
console.log(plugin.getDebugInfo());
// Output:
// {
//   mode: 'child',
//   zone: 'cms',
//   enabled: true,
//   initialized: true,
//   hasParentSentry: true,
//   clientType: 'SentryBrowser'
// }
```

## Migration Guide

### From Individual Sentry Configs

If migrating from separate `sentry.server.config.ts`, `sentry.edge.config.ts`,
and `sentry.client.config.ts` files:

<Steps>
  <Step title="Create centralized config">
    ```typescript
    // sentry.config.ts
    import { createBackstageMicroFrontendPreset } from '@repo/observability/factory/presets';
    
    export const observability = createBackstageMicroFrontendPreset('your-zone').build();
    ```
  </Step>
  
  <Step title="Update instrumentation">
    ```typescript
    // instrumentation.ts
    import { initializeObservability } from './sentry.config';
    
    export async function register() {
      await initializeObservability();
    }
    ```
  </Step>
  
  <Step title="Update client-side error handling">
    ```typescript
    // global-error.tsx
    import { observability } from '#/root/sentry.config';
    
    observability.captureException(error, { component: 'GlobalError' });
    ```
  </Step>
  
  <Step title="Mark old configs as deprecated">
    Keep old files for reference but add deprecation notices:
    ```typescript
    /**
     * @deprecated This file is kept for reference but is no longer used.
     * Sentry configuration has been centralized through @repo/observability.
     * See sentry.config.ts for the new implementation.
     */
    ```
  </Step>
</Steps>

## API Reference

### SentryMicroFrontendPlugin

<ResponseField name="constructor" type="function">
  ```typescript new SentryMicroFrontendPlugin(config?:
  SentryMicroFrontendConfig) ```
</ResponseField>

#### Methods

<ResponseField name="getMode" type="function">
  Returns the current operation mode (host/child/standalone) ```typescript
  getMode(): MicroFrontendMode ```
</ResponseField>

<ResponseField name="getZone" type="function">
  Returns the current zone identifier ```typescript getZone(): string |
  undefined ```
</ResponseField>

<ResponseField name="getDebugInfo" type="function">
  Returns debug information about the plugin state
  ```typescript
  getDebugInfo(): Record<string, any>
  ```
</ResponseField>

<ResponseField name="captureException" type="function">
  Captures an exception with zone context ```typescript captureException(error:
  Error, context?: ObservabilityContext): void ```
</ResponseField>

<ResponseField name="captureMessage" type="function">
  Captures a message with zone context ```typescript captureMessage(message:
  string, level?: LogLevel, context?: ObservabilityContext): void ```
</ResponseField>

<ResponseField name="cleanup" type="function">
  Cleans up resources and event processors
  ```typescript
  cleanup(): Promise<void>
  ```
</ResponseField>

### Utility Functions

<ResponseField name="detectCurrentZone" type="function">
  Detects the current zone from URL patterns or global flags ```typescript
  detectCurrentZone(zones?: ZoneConfig[]): string | undefined ```
</ResponseField>

<ResponseField name="hasParentSentry" type="function">
  Checks if a parent Sentry instance is available ```typescript
  hasParentSentry(): boolean ```
</ResponseField>

<ResponseField name="ensureSingleInit" type="function">
  Prevents duplicate Sentry initialization (thread-safe) ```typescript
  ensureSingleInit(): void ```
</ResponseField>

<ResponseField name="resetInitFlag" type="function">
  Resets initialization flag (primarily for testing) ```typescript
  resetInitFlag(): void ```
</ResponseField>

### Factory Functions

<ResponseField name="createSentryMicroFrontendPlugin" type="function">
  Creates a new plugin instance ```typescript
  createSentryMicroFrontendPlugin(config?: SentryMicroFrontendConfig):
  SentryMicroFrontendPlugin ```
</ResponseField>

<ResponseField name="createBackstageHostPreset" type="function">
  Creates a host preset for backstage architecture ```typescript
  createBackstageHostPreset(zones: ZoneConfig[]): ObservabilityBuilder ```
</ResponseField>

<ResponseField name="createBackstageMicroFrontendPreset" type="function">
  Creates a child preset for backstage micro frontends ```typescript
  createBackstageMicroFrontendPreset(zone: string): ObservabilityBuilder ```
</ResponseField>

## Testing

The plugin includes comprehensive tests covering mode detection, zone detection,
parent Sentry integration, and error handling.

Run tests with:

```bash
pnpm --filter @repo/observability test __tests__/plugins/sentry-microfrontend.test.ts
```

<Note>
  This documentation provides comprehensive guidance for implementing and using
  the Sentry micro frontend plugin in your architecture. For additional support,
  refer to the observability package source code or reach out to the development
  team.
</Note>
