---
title: AI Package
description:
  AI SDK integrations, vector operations, and product classification for the
  Forge platform
---

# AI Package

Comprehensive AI SDK v5 integrations with advanced features including multi-step
agents, computer use tools, React Server Components, and sophisticated streaming
capabilities for building cutting-edge AI-powered applications.

## Overview

The AI package provides enterprise-grade AI capabilities through Vercel AI SDK
v5 integrations, featuring multi-step agent orchestration, Anthropic computer
use tools, React Server Components (RSC), advanced prompt management, vector
operations, and production-ready streaming with metadata tracking and
interruption control.

## Key Components

<CardGroup cols={3}>
  <Card
    title="Multi-Step Agents"
    icon="robot"
    href="/packages/ai/multi-step-agents"
  >
    Advanced agent orchestration with step conditions and workflow management
  </Card>
  <Card
    title="Computer Use Tools"
    icon="desktop"
    href="/packages/ai/computer-use-tools"
  >
    Anthropic computer interaction tools for screenshots, clicks, and automation
  </Card>
  <Card
    title="React Server Components"
    icon="react"
    href="/packages/ai/react-server-components"
  >
    Streaming UI components with createStreamableUI and render functions
  </Card>
  <Card
    title="Prompt Management"
    icon="file-text"
    href="/packages/ai/prompt-management"
  >
    Template system with caching, versioning, and optimization strategies
  </Card>
  <Card
    title="Advanced Streaming"
    icon="activity"
    href="/packages/ai/advanced-streaming"
  >
    Rich metadata, interruption control, and backpressure handling
  </Card>
  <Card
    title="Vector Operations"
    icon="vector-square"
    href="/packages/ai/upstash-vector"
  >
    Upstash Vector database integration for embeddings and similarity search
  </Card>
</CardGroup>

## Features

### AI SDK v5 Core

- **Multi-Provider Support**: OpenAI, Anthropic, Google, Perplexity, xAI, and
  Deep Infra
- **Advanced Generation**: Text, object, and structured data generation with
  streaming
- **Tool Calling**: AI function calling with `inputSchema` and custom tools
- **Embedding Generation**: Text embeddings for similarity search and RAG

### Multi-Step Agents

- **Agent Orchestration**: Complex workflows with step conditions and stopping
  logic
- **Parallel & Sequential Execution**: Run multiple agents concurrently or in
  sequence
- **Step Control**: Dynamic model switching, tool limiting, and temperature
  adjustment
- **Agent Patterns**: Pre-built research, coding, analysis, and communication
  agents

### Computer Use Tools

- **Screen Interaction**: Screenshot capture, click, type, and scroll automation
- **Bash Execution**: Secure command execution with output capture
- **Text Editor**: File viewing, editing, and search capabilities
- **Security**: Sandboxed execution with configurable permissions

### React Server Components

- **Streaming UI**: `streamUI` with enhanced error boundaries and patterns
- **Streamable Components**: `createStreamableUI` with lifecycle hooks
- **Streamable Values**: `createStreamableValue` with transformation support
- **AI Context**: `createAI` with middleware and state management

### Prompt Management

- **Template System**: Reusable prompts with variable substitution
- **Intelligent Caching**: LRU/LFU eviction strategies with hit rate
  optimization
- **Version Control**: Prompt versioning with migration support
- **Composition**: Dynamic prompt building and modular components
- **Optimization**: Token reduction and cost optimization strategies

### Advanced Streaming

- **Rich Metadata**: Timing, usage, quality, and source tracking
- **Stream Control**: Pause, resume, and graceful interruption
- **Backpressure**: Flow control with multiple buffering strategies
- **Enhanced Data**: Typed messages with experimental_streamData

### Vector Database

- **Upstash Vector Integration**: First-class support for vector operations
- **Namespace Management**: Multi-tenant namespace isolation
- **Bulk Operations**: Batch processing for large datasets
- **Search & Retrieval**: Semantic search with metadata filtering

### Classification System

- **Product Classification**: Automated product categorization
- **Confidence Scoring**: 0-1 confidence levels for classifications
- **Alternative Suggestions**: Multiple category options with scores
- **Custom Categories**: Support for hierarchical category structures

## Quick Start

### Installation

```bash
pnpm add @repo/ai
```

### Environment Variables

```bash
# AI Providers (choose one or more)
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GOOGLE_GENERATIVE_AI_API_KEY=...

# Vector Database (optional)
UPSTASH_VECTOR_REST_URL=https://...
UPSTASH_VECTOR_REST_TOKEN=...
```

### Basic Usage

```typescript
import { generateText } from "ai";
import { createOpenAIModel } from "@repo/ai/server/next";

// Generate text with OpenAI
const model = createOpenAIModel("gpt-4");
const result = await generateText({
  model,
  prompt: "Explain artificial intelligence"
});

console.log(result.text);
```

### Advanced Usage Examples

```typescript
// Multi-step agent execution
import { executeMultiStepAgent, stepCountAtMost } from "@repo/ai/server/agents";

const result = await executeMultiStepAgent({
  model: createAnthropicModel("claude-3-5-sonnet-20241022"),
  messages: [{ role: "user", content: "Research and analyze market trends" }],
  maxSteps: 5,
  stopWhen: stepCountAtMost(3),
  onStepFinish: ({ stepNumber, result }) => {
    console.log(`Step ${stepNumber} completed:`, result.text);
  }
});
```

```typescript
// Computer use tools
import { createComputerTool, createBashTool } from "@repo/ai/server/tools";

const tools = {
  computer: createComputerTool({ display: 1 }),
  bash: createBashTool({ workingDirectory: "/tmp" })
};

const result = await generateText({
  model: createAnthropicModel("claude-3-5-sonnet-20241022"),
  messages: [{ role: "user", content: "Take a screenshot and list files" }],
  tools
});
```

```typescript
// React Server Components
import { streamUI } from "@repo/ai/rsc";
import { createAnthropicModel } from "@repo/ai/server/next";

const result = await streamUI({
  model: createAnthropicModel("claude-3-5-sonnet-20241022"),
  messages: [{ role: "user", content: "Create a dashboard" }],
  text: ({ content }) => <div>{content}</div>,
  tools: {
    showChart: {
      description: "Display a chart",
      inputSchema: z.object({ data: z.array(z.number()) }),
      generate: async ({ data }) => <Chart data={data} />
    }
  }
});
```

## Architecture

### Export Pattern

The package follows the standard multi-environment export pattern:

- `@repo/ai/client` - Browser utilities (non-Next.js)
- `@repo/ai/server` - Node.js utilities (non-Next.js)
- `@repo/ai/client/next` - Next.js client components
- `@repo/ai/server/next` - Next.js server utilities
- `@repo/ai/server/edge` - Edge runtime support
- `@repo/ai/rsc` - React Server Components
- `@repo/ai/server/agents` - Multi-step agent system
- `@repo/ai/shared` - Environment-agnostic utilities

### Type Safety

Full TypeScript support with comprehensive type definitions:

```typescript
import type {
  // Agent types
  MultiStepConfig,
  MultiStepResult,
  StepCondition,
  AgentDefinition,
  // Streaming types
  StreamMetadata,
  BackpressureConfig,
  // RSC types
  StreamableUI,
  StreamableValue,
  // Prompt types
  PromptTemplate,
  PromptCacheConfig,
  // Legacy types
  ProductClassificationResult,
  VectorSearchResult,
  RAGResponse
} from "@repo/ai/server/next";
```

## Use Cases

### Multi-Step Research Agent

```typescript
// Research workflow with multiple steps
import {
  executeMultiStepAgent,
  createResearchAgent
} from "@repo/ai/server/agents";

const agent = createResearchAgent({
  searchTools: true,
  analysisTools: true,
  summaryGeneration: true
});

const research = await executeMultiStepAgent({
  ...agent,
  messages: [
    { role: "user", content: "Research the impact of AI on healthcare" }
  ],
  maxSteps: 8,
  onStepFinish: ({ stepNumber, result, reasoning }) => {
    console.log(`Research step ${stepNumber}:`, reasoning);
  }
});
```

### Automated Computer Tasks

```typescript
// Automate desktop interactions
import {
  createComputerTool,
  createTextEditorTool
} from "@repo/ai/server/tools";

const result = await generateText({
  model: createAnthropicModel("claude-3-5-sonnet-20241022"),
  messages: [
    {
      role: "user",
      content:
        "Open the file report.txt, find the sales data, and create a summary"
    }
  ],
  tools: {
    computer: createComputerTool({ display: 1 }),
    editor: createTextEditorTool({ allowedPaths: ["/workspace"] })
  }
});
```

### Streaming UI with Components

```typescript
// Dynamic UI generation
import { streamUI } from "@repo/ai/rsc";

const ui = await streamUI({
  model: createAnthropicModel("claude-3-5-sonnet-20241022"),
  messages: [{ role: "user", content: "Create a data visualization" }],
  text: ({ content }) => <div className="prose">{content}</div>,
  tools: {
    createChart: {
      description: "Generate an interactive chart",
      inputSchema: z.object({
        type: z.enum(["bar", "line", "pie"]),
        data: z.array(z.object({ label: z.string(), value: z.number() }))
      }),
      generate: async ({ type, data }) => (
        <div className="w-full h-64">
          <Chart type={type} data={data} interactive />
        </div>
      )
    }
  }
});
```

### Advanced Prompt Management

```typescript
// Template-based prompt generation
import { PromptTemplateRegistry, createPrompt } from "@repo/ai/server/prompts";

const templates = new PromptTemplateRegistry();
templates.register("analysis", {
  template:
    "Analyze the {{topic}} data focusing on {{aspects}}. Provide {{format}} output.",
  variables: ["topic", "aspects", "format"],
  metadata: { category: "analysis", version: "1.0" }
});

const prompt = createPrompt("analysis", {
  topic: "sales performance",
  aspects: "trends and outliers",
  format: "structured JSON"
});

const result = await generateObject({
  model: createOpenAIModel("gpt-4"),
  prompt: prompt.render(),
  schema: z.object({
    trends: z.array(z.string()),
    outliers: z.array(z.string())
  })
});
```

### Content Generation with Metadata

```typescript
// Generate content with rich streaming metadata
import {
  MetadataStream,
  streamTextWithConfig
} from "@repo/ai/server/streaming";

const metadata = new MetadataStream();
metadata.setModelMetadata({
  name: "Claude 3.5 Sonnet",
  provider: "anthropic",
  temperature: 0.7
});

const result = await streamTextWithConfig({
  model: createAnthropicModel("claude-3-5-sonnet-20241022"),
  prompt: "Write a comprehensive blog post about renewable energy",
  onChunk: (chunk) => {
    metadata.processChunk(chunk);
  },
  onFinish: (finalResult) => {
    metadata.finalize(finalResult.usage);
    console.log("Generation metadata:", metadata.getMetadata());
  }
});
```

## Documentation

<CardGroup cols={3}>
  <Card
    title="Multi-Step Agents"
    icon="robot"
    href="/packages/ai/multi-step-agents"
  >
    Agent orchestration, workflows, and step conditions
  </Card>
  <Card
    title="Computer Use Tools"
    icon="desktop"
    href="/packages/ai/computer-use-tools"
  >
    Screen interaction, bash execution, and file editing
  </Card>
  <Card
    title="React Server Components"
    icon="react"
    href="/packages/ai/react-server-components"
  >
    Streaming UI, streamable values, and AI context
  </Card>
  <Card
    title="Prompt Management"
    icon="file-text"
    href="/packages/ai/prompt-management"
  >
    Templates, caching, versioning, and optimization
  </Card>
  <Card
    title="Advanced Streaming"
    icon="activity"
    href="/packages/ai/advanced-streaming"
  >
    Metadata, interruption, and backpressure control
  </Card>
  <Card title="Package Overview" icon="book-open" href="/packages/ai/overview">
    Complete feature overview and API reference
  </Card>
</CardGroup>

## Performance Considerations

- **Agent Optimization**: Use step conditions to prevent infinite loops
- **Computer Tools**: Implement timeouts and resource limits for safety
- **Streaming**: Leverage backpressure control for high-volume streams
- **Prompt Caching**: Cache frequently used templates and compilations
- **Model Selection**: Choose models based on task complexity and cost
- **Vector Operations**: Use appropriate embedding models and batch sizes
- **Rate Limiting**: Respect API limits and implement backoff strategies

## Security

- **Computer Use**: Sandbox execution environments and limit file access
- **Agent Workflows**: Implement step validation and execution timeouts
- **Prompt Injection**: Validate and sanitize template variables
- **Stream Security**: Use secure connections and validate metadata
- **API Keys**: Store securely using environment variables
- **Multi-tenancy**: Use namespace isolation for applications
- **Input Validation**: Validate inputs before AI processing
- **Error Handling**: Implement proper error handling and fallbacks

## Recent Updates

### AI SDK v5 Integration Complete ✅

- **Multi-Step Agents**: Full workflow orchestration with step conditions
- **Computer Use Tools**: Anthropic computer interaction capabilities
- **React Server Components**: Complete RSC integration with streaming UI
- **Prompt Management**: Enterprise-grade template and caching system
- **Advanced Streaming**: Rich metadata and flow control

### What's New in v5

- **Enhanced Tool System**: `inputSchema` with full TypeScript inference
- **Agent Patterns**: Pre-built agent configurations for common tasks
- **Stream Control**: Pause, resume, and interrupt streaming operations
- **Metadata Tracking**: Comprehensive usage, timing, and quality metrics
- **Backpressure Handling**: Intelligent flow control for high-volume streams

The AI package now provides enterprise-grade AI capabilities with comprehensive
feature coverage of the latest AI SDK v5 specifications, ready for production
deployment with advanced agent workflows and sophisticated streaming controls.
