# MCP Utils Package

The MCP Utils package exposes high-leverage utilities to Claude Code agents via
the Model Context Protocol. After the October 2025 refresh, the package focuses
on reporting, workflow orchestration, performance diagnostics, and analysis
helpers.

## Installation & Setup

The package is part of the workspace monorepo. No additional installation steps
are required beyond enabling the `forge` MCP server in `.mcp.json`:

```json
{
  "mcpServers": {
    "forge": {
      "command": "node",
      "args": ["./packages/mcp-server/bin/mcp-server.mjs"],
      "env": {
        "NODE_ENV": "production",
        "LOG_LEVEL": "info"
      },
      "disabled": false
    }
  }
}
```

## Core MCP Tools

| Tool                                | Purpose                                               |
| ----------------------------------- | ----------------------------------------------------- |
| `mcp__forge__safe_stringify`        | Safe JSON serialization with circular reference data. |
| `mcp__forge__report_generator`      | Generate human-readable summaries for hand-offs.      |
| `mcp__forge__workflow_orchestrator` | Coordinate multi-step agent workflows.                |
| `mcp__forge__worktree_manager`      | Create, list, and remove git worktrees.               |
| `mcp__forge__memory_monitor`        | Inspect memory pressure and trigger cleanups.         |

> Legacy cache-management tools have been removed. Internal cache utilities
> remain available for TypeScript consumption via direct imports.

## Usage Examples

### Safe Stringification

```ts
const stringifyResult = await mcp__forge__safe_stringify({
  obj: {
    session: `analysis-${Date.now()}`,
    files: changedFiles,
    insights: await computeInsights(changedFiles)
  },
  prettify: true,
  includeMetadata: true
});

const payload = JSON.parse(stringifyResult.content[0].text);
console.log(payload.result);
```

### Generate a Report

```ts
const result = await mcp__forge__report_generator({
  title: "Weekly Architecture Review",
  sections: [
    { heading: "Highlights", content: highlights.join("\n") },
    { heading: "Risks", content: risks.join("\n") },
    { heading: "Next Steps", content: nextSteps.join("\n") }
  ]
});

console.log(result.content[0].text);
```

## Direct TypeScript Imports

Agents that run outside MCP or backend services can import the underlying
utilities directly from `@repo/mcp-server` and `@repo/core-utils`:

```ts
import { safeStringify } from "@repo/core-utils/shared/stringify";
import { workflowOrchestratorTool } from "@repo/core-utils/server/workflow-orchestrator";

const json = safeStringify(data);
const orchestration = await workflowOrchestratorTool.execute({
  workflow: "code-modernization",
  steps: ["analyze", "plan", "apply"]
});
```

## Troubleshooting

- **Tools aren't listed in Claude Code:** confirm `.mcp.json` sets
  `"disabled": false` and restart the IDE.
- **Memory pressure warnings:** run `memory_monitor` with
  `action: "comprehensiveReport"` to receive a structured diagnostic payload.

## Additional Reading

- `packages/mcp-server/README.md` – full package overview.
- `packages/core-utils/README.md` – in-depth documentation for reusable
  utilities.
- [Model Context Protocol](https://modelcontextprotocol.io) – official protocol
  specification and SDK guides.
